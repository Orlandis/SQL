Предоставление/отключение прав к объектам БД
GRANT
DENY
Все разрешения и запреты прописываются в ролях, а роли назначаются пользователю/группе
----------------------------------------------
Создание роли - CREATE ROLE
Для создания ролей необходимо иметь как минимум одну из стандартных ролей:
- db_securityadmin - пользователи этой роли могут создавать пользовательские роли
- db_owner

Нужно знать все стандартные роли, понимать за что они отвечают 
----------------------------------------------
Совместимость версий SQL. За возможность подключить БД от другой версии сервера отвечает 
параметр compatibility level. Каждая версия сервера поддерживает одну или несколько более 
ранних версий, это ВАЖНЫЙ момент когда необходимо обновить сервер и подключить БД созданные 
в ранних версиях, на это влияет этот compatibility level (уровень совместимости)

select @@VERSION - для проверки версии SQL Server
select compatibility_level from sys.databases where name = 'AdventureWorks2016' - для выяснения уровня совместимости БД
alter database AdventureWorks2016 set compatibility_level = 140 - пример установки нужного уровня
----------------------------------------------
CLR сборки - связь сторонних обработок с SQL - Common Runtime Language
Это когда ты пишешь говнокод не на T-SQL, а на C#, например, или любом дот-нет языке, 
потом цепляешь это дело к серверу в виде ДЛЛ-ки и вызываешь уже в T-SQL методы из этой ДЛЛ-ки
----------------------------------------------
Самые часто используемые типы данных для полей таблиц - INT, VARCHAR, DATE
----------------------------------------------
Проверка используемых портов в SQL Server
sp_readerrorlog 0, 1, N'Server is list' - Эта, хранимая процедура возвращает содержание errorlog файла
Более объёмная инфо по данной процедуре http://sqlcom.ru/dba-tools/errorlog/. 
У неё есть четыре входных параметра:
@p1 — номер журнала (0-6); 0 — текущий
@p2 — чей журнал; 1 — SQL Server, 2 — SQL Server Agent
@p3 — фильтр для поиска
@p4 — второе условие для поиска - НЕ ОБЯЗАТЕЛЬНЫЙ ПАРАМЕТР, для более точного отбора
Пример - sp_readerrorlog 0, 1, N'error', N'34050'

Работа с портами зависит от типа инстанса:
- Если инстанс дефолтный с именем SQLSERVER - работает по умолчанию по порту 1434
- Если при установке меняется имя - порт выбирается автоматически другой, НУЖНО ПОМНИТЬ ЭТО ПРИ НАСТРОЙКЕ ФАЕРВОЛА
----------------------------------------------
При полной модели востановления чекпойнт работает так же, как и при простой, но записи из лога не очищаются, 
а просто страницы из памяти скидываются на диск, а ЛОГ ОЧИЩАЕТСЯ ПОСЛЕ БЕКАПА ЛОГА

Максимальный размер файла лога - 2 Тб

Для поддержания размера лога в разумных пределах и возможности восстановления на определенный момент времени 
необходимо настроить регулярный бэкап лога, а диф в этом случае нужен для того, чтобы ускорить процесс восстановления 
(если у тебя всё упало в субботу, то без дифа придётся восстанавливать всю цепочку логов с воскресенья, 
а так - бэкап, потом последний диф за пятницу и на него уже логи за ОДИН день, а не за шесть)
В этом есть смысл дифференциального: от английского difference - разница, т.е. это разница между полным бэкапом и текущим моментомВ
----------------------------------------------
DB_ID(), DB_NAME() - функции получения ID кода или имён баз
Пример:
- select DB_NAME(4), где 4 - номер базы из sys.databases вернет имя MSDB
- select DB_ID('tempdb') вернет 2 - это номер базы из sys.databases
----------------------------------------------
Бекап может содержать как один файл так и несколько, для хранения нескольких бекапов в одном файле, при создании следующего
бекапа просто указывается одно и то же имя файла, и бекап получается составной
----------------------------------------------
При аварии базы, в обязательном порядке необходимо попытаться выполнить бекап лога, так называемый - TAIL LOG BACKUP 
----------------------------------------------
В регламентные задачи, необходимо включить чек базы (DBCC CHECKDB). 
Примеры для регулярного использования :
- dbcc checkdb (AdventureWorks2014) with NO_INFOMSGS, ALL_ERRORMSGS	-	в данном случае будут отображены только сообщения с ошибками 	
- dbcc checkdb (AdventureWorks2014) with ALL_ERRORMSGS 	-	в данном случае будут отображены все сообщения (инфо и ошибки) 	
----------------------------------------------
Лайвхак при написании скриптов - при проведении проверки на выбранную базу, чтобы не писать каждый раз имя БД в скрипте, 
можно его выбрать в SSMS, в поле выбора БД и в скрипт автоматом будет подставляться имя выбраненой БД за счёт кода ниже
bs.database_name = DB_NAME(DB_ID())
----------------------------------------------
Быстрая вставка из выборки, одна из разновидностей BULK INSERT - работает очень быстро. 

Вместо create table #test1 и потом insert , можно сразу делать вот такое (код ниже)
При этом создается таблица (необязательно временная) с такими же типами полей, как в выборке

SELECT
    bs.database_name,bs.type,
    bs.backup_start_date,
    bmf.physical_device_name

into #test

FROM
    msdb.dbo.backupmediafamily bmf
    JOIN
    msdb.dbo.backupset bs ON bs.media_set_id = bmf.media_set_id
----------------------------------------------
----------------------------------------------
